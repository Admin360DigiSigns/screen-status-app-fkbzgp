
# Project-wide Gradle settings for Expo/React Native

# Specifies the JVM arguments used for the daemon process.
# EXTREME MEMORY ALLOCATION - CRITICAL FOR METASPACE ERROR
# Increased Metaspace from 8GB to 12GB to handle KSP compilation
org.gradle.jvmargs=-Xmx20480m -XX:MaxMetaspaceSize=12288m -XX:ReservedCodeCacheSize=3072m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8 -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:G1HeapRegionSize=32m -XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=20 -XX:G1MaxNewSizePercent=40

# DISABLE parallel builds to reduce memory pressure
org.gradle.parallel=false

# REDUCE Gradle daemon workers to prevent memory exhaustion
org.gradle.workers.max=1

# Disable configuration cache to save memory
org.gradle.configuration-cache=false
org.gradle.configuration-cache.problems=warn

# Enable build cache
org.gradle.caching=true

# AndroidX
android.useAndroidX=true
android.enableJetifier=true

# Kotlin compiler memory settings (critical for KSP) - EXTREME ALLOCATION
# Increased from 10GB to 12GB Metaspace for KSP tasks
kotlin.daemon.jvmargs=-Xmx12288m -XX:MaxMetaspaceSize=8192m -XX:ReservedCodeCacheSize=3072m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions

# KAPT memory settings - EXTREME ALLOCATION
kapt.daemon.jvm.options=-Xmx12288m -XX:MaxMetaspaceSize=8192m

# Disable R8 full mode to save memory
android.enableR8.fullMode=false

# Increase daemon idle timeout
org.gradle.daemon.idletimeout=3600000

# Optimize Dex in process
android.enableDexingArtifactTransform=false

# Disable unnecessary features to save memory
android.enableBuildCache=true
android.enableD8.desugaring=true

# KSP-specific memory settings - CRITICAL FOR METASPACE ERROR
ksp.incremental=false
ksp.incremental.intermodule=false
ksp.use.worker.api=false

# Reduce Kotlin compiler memory pressure
kotlin.incremental=false
kotlin.compiler.execution.strategy=in-process

# Disable Gradle daemon performance logging
org.gradle.daemon.performance.disable-logging=true

# Additional memory optimization flags
org.gradle.jvmargs.kapt=-Xmx12288m -XX:MaxMetaspaceSize=8192m
org.gradle.jvmargs.kotlin=-Xmx12288m -XX:MaxMetaspaceSize=8192m

# Force single-threaded compilation for KSP
kotlin.compiler.execution.strategy=in-process
kotlin.parallel.tasks.in.project=false

# New Architecture (required for react-native-reanimated)
newArchEnabled=true

# KSP-specific JVM arguments to prevent Metaspace OOM
ksp.jvm.args=-Xmx12288m -XX:MaxMetaspaceSize=8192m -XX:+UseG1GC -XX:MaxGCPauseMillis=200

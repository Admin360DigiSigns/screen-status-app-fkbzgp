
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Command API</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0F172A 0%, #1E293B 50%, #334155 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: rgba(30, 41, 59, 0.95);
      border-radius: 24px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
    }

    h1 {
      color: #10B981;
      margin-bottom: 10px;
      font-size: 32px;
      text-align: center;
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.6);
      text-align: center;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    label {
      display: block;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select {
      width: 100%;
      padding: 14px 16px;
      background: #0F172A;
      border: 2px solid #334155;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #10B981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 32px;
    }

    button {
      padding: 18px 24px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      color: white;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    button:hover::before {
      transform: translateX(0);
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    button:active {
      transform: translateY(-1px);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-preview {
      background: linear-gradient(135deg, #2563EB, #1E40AF);
    }

    .btn-screenshare {
      background: linear-gradient(135deg, #9333EA, #7E22CE);
    }

    .btn-sync {
      background: linear-gradient(135deg, #059669, #047857);
    }

    .btn-logout {
      background: linear-gradient(135deg, #DC2626, #B91C1C);
    }

    .status-box {
      margin-top: 24px;
      padding: 16px 20px;
      border-radius: 12px;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status-box.success {
      background: rgba(16, 185, 129, 0.15);
      border: 2px solid #10B981;
      color: #10B981;
    }

    .status-box.error {
      background: rgba(239, 68, 68, 0.15);
      border: 2px solid #EF4444;
      color: #EF4444;
    }

    .status-box.loading {
      background: rgba(59, 130, 246, 0.15);
      border: 2px solid #3B82F6;
      color: #3B82F6;
    }

    .status-title {
      font-weight: bold;
      margin-bottom: 4px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-message {
      font-size: 14px;
      line-height: 1.5;
    }

    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border: 2px solid #3B82F6;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 13px;
      line-height: 1.6;
    }

    .info-box strong {
      color: #3B82F6;
    }

    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(59, 130, 246, 0.3);
      border-top-color: #3B82F6;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Command API Tester</h1>
    <p class="subtitle">Test remote commands for your mobile app</p>

    <div class="info-box">
      <strong>‚ÑπÔ∏è Instructions:</strong> Enter the screen name or device ID of your mobile device, then click any command button to test. Make sure your mobile app is logged in and on the home screen.
    </div>

    <div class="form-group">
      <label for="identifier-type">Identify Device By</label>
      <select id="identifier-type">
        <option value="screen_name">Screen Name</option>
        <option value="device_id">Device ID</option>
      </select>
    </div>

    <div class="form-group">
      <label for="identifier-value">Value</label>
      <input 
        type="text" 
        id="identifier-value" 
        placeholder="e.g., Lobby Display or abc123xyz"
        autocomplete="off"
      >
    </div>

    <div class="button-grid">
      <button class="btn-preview" onclick="sendCommand('preview_content')">
        üé¨ Preview Content
      </button>

      <button class="btn-screenshare" onclick="sendCommand('screenshare')">
        üì∫ Screen Share
      </button>

      <button class="btn-sync" onclick="sendCommand('sync_status')">
        üîÑ Sync Status
      </button>

      <button class="btn-logout" onclick="sendCommand('logout')">
        üö™ Logout
      </button>
    </div>

    <div id="status" class="status-box"></div>
  </div>

  <script>
    const API_URL = 'https://gzyywcqlrjimjegbtoyc.supabase.co/functions/v1/send-app-command';

    function getCommandLabel(command) {
      const labels = {
        'preview_content': 'Preview Content',
        'screenshare': 'Screen Share',
        'sync_status': 'Sync Status',
        'logout': 'Logout'
      };
      return labels[command] || command;
    }

    async function sendCommand(command) {
      const identifierType = document.getElementById('identifier-type').value;
      const identifierValue = document.getElementById('identifier-value').value.trim();
      const statusEl = document.getElementById('status');

      // Validation
      if (!identifierValue) {
        showStatus('error', 'Validation Error', 'Please enter a screen name or device ID');
        return;
      }

      // Show loading state
      showStatus('loading', 'Sending Command', `Sending "${getCommandLabel(command)}" command...`);

      // Disable all buttons
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => btn.disabled = true);

      try {
        const payload = {
          [identifierType]: identifierValue,
          command: command
        };

        console.log('Sending command:', payload);

        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        });

        const data = await response.json();
        console.log('Response:', data);

        if (response.ok) {
          showStatus(
            'success',
            'Command Sent Successfully',
            `‚úÖ "${getCommandLabel(command)}" command sent to ${data.screen_name || identifierValue}\n\nCommand ID: ${data.command_id}\nDevice ID: ${data.device_id}`
          );
        } else {
          showStatus(
            'error',
            'Command Failed',
            `‚ùå ${data.error || 'Unknown error occurred'}`
          );
        }
      } catch (error) {
        console.error('Error:', error);
        showStatus(
          'error',
          'Network Error',
          `‚ùå Failed to connect to API: ${error.message}`
        );
      } finally {
        // Re-enable buttons
        buttons.forEach(btn => btn.disabled = false);
      }
    }

    function showStatus(type, title, message) {
      const statusEl = document.getElementById('status');
      
      let icon = '';
      if (type === 'loading') {
        icon = '<span class="spinner"></span>';
      }

      statusEl.innerHTML = `
        ${icon}
        <div class="status-title">${title}</div>
        <div class="status-message">${message}</div>
      `;
      
      statusEl.className = `status-box ${type}`;
      statusEl.style.display = 'block';

      // Auto-hide success/error messages after 8 seconds
      if (type !== 'loading') {
        setTimeout(() => {
          statusEl.style.display = 'none';
        }, 8000);
      }
    }

    // Allow Enter key to submit
    document.getElementById('identifier-value').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendCommand('preview_content');
      }
    });

    // Focus input on load
    window.addEventListener('load', () => {
      document.getElementById('identifier-value').focus();
    });
  </script>
</body>
</html>
